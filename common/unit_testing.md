# Test Code Writing Guidelines

This is the translated version of [Japanese Document](http://qiita.com/irohiroki/items/d857f8ddee387e0ab199) written by Hiroki Yoshioka.

If you write test code without deep consideration, the following things may happen.

* Time for testing may become longer. You may need to wait, or just become skipping/ignoring test result.
* You will not be able to get enough benefit from these testing code and testing process compare with the time you spent for writing/executing test code.

To avoid these kind of situations, you should follow the following guidelines.

## Triage: Ranking test code by using the value from the business point of view.

The following ranking is based of the "business value" of the code.

### Major

* Affect to the functionality which is very important for the service value
* That code will be reuse on widely situations.
* It may produce problems which cannot avoid, or there are no work around.

### Minor

* Affect to the functionality which is not so important for the service value.
* That code will not be reuse so much times.
* It may produce problems but there are work-around.

### Trivial

* Not affect to the service value.
* Problem looks wired, but can be allowed.
* No need to avoid the situation.

If the code may be categorized to the multiple level, it may be categorized highest level. 

If target code may be categorized to "Major", you should write much more test code and long execution time can be allowed.

If target code may be categorized to "Minor", you should write test code only for minimum normal workflow.

If target code may be categorized to "Trivial", you should not write test code.


## You should write minimum amount of integration tests.

You should minimize the target of integration test as follows.

* Interfaces between different layer ( View - Controller - Service - Repository - Model )
* Process related with multiple HTTP requests.

"View" includes JavaScript tests.

You can refer following examples.

* Consistency of request parameters between set by links, buttons, form and Controllers.
* Consistency between request parameters and model's scope.
* Consistency between instances generated by controllers and result of views.
* Interaction between multiple users.

You should know that integration test takes long time, so you need to do only 1 test per one objective. If you want to do comprehensive tests with value variations, you should do it on unit testing.

### You need to test controller only for the responsibility which the controller should have.

When you write controller test code, you can write only the following test codes.

* Calling methods of other classes.
* HTTP Status code
* Redirect URLs.
* cookies / sessions
* Flash data 

If the controller does other tasks than above, move the task to other classes/modules with the following steps.

1. Write Controller test which focus on these tasks.
2. Move these tasks to other more adequateã€€classes/modules
3. Move the test to new class/module's place and only interface with the class will be tested in controller test code.

If there are objects/instances which controller creates and be used in view, do the integration test.

#### Never write test for private methods

You should not write test code for private methods for the following reasons.

* Writing test for private methods will decrease flexibility of implementation and make refactoring difficult.
* On the Object oriented programming, we should test the interface between objects. Private methods are not the interface.

#### Use Stab or Mock for the objects which are out of focus.

You need to use stab/mock if you need to prepare object which is not in a scope of the test.

But if there are multiple solution for using out of scope document ( e.g. Ruby on Rails: Controller uses scope of model with checking in ), you can use real object for it.


#### You need to discuss on your team

This is just a guidelines, you need to discuss in your team and decide your own one based on this document.
